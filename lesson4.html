<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ç¬¬4ï½6èª² è‡ªé¸å–®å­—ç·´ç¿’</title>
  <style>
    body {
      font-family: "Helvetica Neue", sans-serif;
      background-color: #ffe4f0;
      color: #333;
      padding: 20px;
      text-align: center;
    }
    .lesson {
      background: #fff0f5;
      padding: 10px;
      margin: 20px auto;
      width: fit-content;
      border-radius: 12px;
      text-align: left;
    }
    .lesson h3 {
      margin-top: 0;
    }
    .option-button {
      background-color: #fff;
      margin: 5px;
      padding: 10px 20px;
      border: 2px solid #ff99cc;
      border-radius: 12px;
      font-size: 16px;
      cursor: pointer;
    }
    button {
      padding: 10px 16px;
      margin: 10px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      background-color: #ffccdd;
      cursor: pointer;
    }
    #result {
      margin-top: 10px;
      font-size: 18px;
      font-weight: bold;
    }
    #question {
      font-size: 22px;
      margin: 20px 0;
    }
    #quizArea {
      margin-top: 30px;
      padding: 20px;
      background: #fffafc;
      border-radius: 12px;
    }
  </style>
</head>
<body>
  <h1>ç¬¬4ï½6èª² è‡ªé¸å–®å­—ç·´ç¿’</h1>

  <div>
    é¡Œç›®æ–¹å‘ï¼š
    <select id="modeSelect">
      <option value="jpToZh">æ—¥æ–‡ â¡ ä¸­æ–‡ï¼ˆé è¨­ï¼‰</option>
      <option value="zhToJp">ä¸­æ–‡ â¡ æ—¥æ–‡</option>
    </select>
  </div>

  <div>
    é¡Œå‹é¸æ“‡ï¼š
    <select id="typeSelect">
      <option value="choice">é¸æ“‡é¡Œï¼ˆé è¨­ï¼‰</option>
      <option value="input">æ‰“å­—é¡Œ</option>
    </select>
  </div>

  <div>
    é¸æ“‡èª²æ¬¡ï¼š
    <select id="lessonSelect">
      <option value="">-- è«‹é¸æ“‡èª²æ¬¡ --</option>
      <option value="ç¬¬4èª²">ç¬¬4èª²</option>
      <option value="ç¬¬5èª²">ç¬¬5èª²</option>
      <option value="ç¬¬6èª²">ç¬¬6èª²</option>
    </select>
  </div>

  <div id="wordSelection"></div>
  <button onclick="startQuiz()">â–¶ï¸ é–‹å§‹æ¸¬é©—</button>
  <button onclick="unlockSelection()">ğŸ” é‡æ–°é¸å–®å­—</button>

  <div id="quizArea">
    <div id="question">â† é»ä¸Šæ–¹æŒ‰éˆ•é–‹å§‹ç·´ç¿’</div>
    <div id="options"></div>
    <div id="result"></div>
    <div>
      åˆ†æ•¸ï¼š<span id="score">0</span><br>
      æœ€é«˜åˆ†ï¼š<span id="highscore">0</span><br>
      ç­”å°ç‡ï¼š<span id="accuracy">0%</span>ï¼ˆ<span id="correct">0</span> / <span id="total">0</span> é¡Œï¼‰
    </div>
    <button onclick="speakWord()">ğŸ”Š æœ—è®€æ—¥æ–‡</button>
    <button onclick="resetScore()">ğŸ” é‡ç½®åˆ†æ•¸</button>
  </div>

  <div id="endScreen" style="display: none; margin-top: 20px; text-align: center;">
    <h3>ğŸ‰ æ¸¬é©—å®Œæˆï¼</h3>
    <p>ä½ çš„ç¸½å¾—åˆ†æ˜¯ï¼š<span id="finalScore">0</span> åˆ†</p>
    <button onclick="goHome()">ğŸ”™ å›é¦–é </button>
  </div>

  <div style="margin-top: 20px;">
    <button onclick="showHistory()">ğŸ“œ çœ‹æ­·å²ç´€éŒ„</button>
  </div>

  <div id="historyArea" style="display:none; margin-top: 20px; padding: 10px; background: #fff; border: 2px dashed #ff99cc; border-radius: 12px;">
    <h3>ğŸ“š æ­·å²ç´€éŒ„</h3>
    <div id="historyList"></div>
    <button onclick="clearHistory()">ğŸ—‘ æ¸…é™¤ç´€éŒ„</button>
    <button onclick="hideHistory()">âŒ é—œé–‰</button>
  </div>

  <script>
    const allLessons = {
      "ç¬¬4èª²": [
        { jp: "èµ·ãã¾ã™", zh: "èµ·åºŠ" }, { jp: "å¯ã¾ã™", zh: "ç¡è¦º" }, { jp: "åƒãã¾ã™", zh: "å·¥ä½œ" },
        { jp: "ä¼‘ã¿ã¾ã™", zh: "ä¼‘æ¯" }, { jp: "å‹‰å¼·ã—ã¾ã™", zh: "è®€æ›¸ã€å­¸ç¿’" }, { jp: "çµ‚ã‚ã‚Šã¾ã™", zh: "çµæŸ" },
        { jp: "ãƒ‡ãƒ‘ãƒ¼ãƒˆ", zh: "ç™¾è²¨å…¬å¸" }, { jp: "éŠ€è¡Œï¼ˆãã‚“ã“ã†ï¼‰", zh: "éŠ€è¡Œ" }, { jp: "éƒµä¾¿å±€ï¼ˆã‚†ã†ã³ã‚“ãã‚‡ãï¼‰", zh: "éƒµå±€" },
        { jp: "å›³æ›¸é¤¨ï¼ˆã¨ã—ã‚‡ã‹ã‚“ï¼‰", zh: "åœ–æ›¸é¤¨" }, { jp: "ç¾è¡“é¤¨ï¼ˆã³ã˜ã‚…ã¤ã‹ã‚“ï¼‰", zh: "ç¾è¡“é¤¨" }, { jp: "ä»Šï¼ˆã„ã¾ï¼‰", zh: "ç¾åœ¨" },
        { jp: "ï½æ™‚ï¼ˆã˜ï¼‰", zh: "ï½é»" }, { jp: "ï½åˆ†ï¼ˆãµã‚“ / ã·ã‚“ï¼‰", zh: "ï½åˆ†" }, { jp: "åˆå‰ï¼ˆã”ãœã‚“ï¼‰", zh: "ä¸Šåˆ" },
        { jp: "åˆå¾Œï¼ˆã”ã”ï¼‰", zh: "ä¸‹åˆ" }, { jp: "æœï¼ˆã‚ã•ï¼‰", zh: "æ—©ä¸Š" }, { jp: "æ˜¼ï¼ˆã²ã‚‹ï¼‰", zh: "ä¸­åˆ" },
        { jp: "æ™©ï¼ˆã°ã‚“ï¼‰/ å¤œï¼ˆã‚ˆã‚‹ï¼‰", zh: "æ™šä¸Š" }, { jp: "ä¼‘ã¿", zh: "ä¼‘å‡" }, { jp: "æ˜¼ä¼‘ã¿ï¼ˆã²ã‚‹ã‚„ã™ã¿ï¼‰", zh: "åˆä¼‘" },
        { jp: "æ¯æœï¼ˆã¾ã„ã‚ã•ï¼‰", zh: "æ¯å¤©æ—©ä¸Š" }, { jp: "æ¯æ™©ï¼ˆã¾ã„ã°ã‚“ï¼‰", zh: "æ¯å¤©æ™šä¸Š" }, { jp: "æ¯æ—¥ï¼ˆã¾ã„ã«ã¡ï¼‰", zh: "æ¯å¤©" },
        { jp: "æœˆæ›œæ—¥ï¼ˆã’ã¤ã‚ˆã†ã³ï¼‰", zh: "æ˜ŸæœŸä¸€" }, { jp: "ç«æ›œæ—¥ï¼ˆã‹ã‚ˆã†ã³ï¼‰", zh: "æ˜ŸæœŸäºŒ" }, { jp: "æ°´æ›œæ—¥ï¼ˆã™ã„ã‚ˆã†ã³ï¼‰", zh: "æ˜ŸæœŸä¸‰" },
        { jp: "æœ¨æ›œæ—¥ï¼ˆã‚‚ãã‚ˆã†ã³ï¼‰", zh: "æ˜ŸæœŸå››" }, { jp: "é‡‘æ›œæ—¥ï¼ˆãã‚“ã‚ˆã†ã³ï¼‰", zh: "æ˜ŸæœŸäº”" }, { jp: "åœŸæ›œæ—¥ï¼ˆã©ã‚ˆã†ã³ï¼‰", zh: "æ˜ŸæœŸå…­" },
        { jp: "æ—¥æ›œæ—¥ï¼ˆã«ã¡ã‚ˆã†ã³ï¼‰", zh: "æ˜ŸæœŸæ—¥" }, { jp: "ä½•æ›œæ—¥ï¼ˆãªã‚“ã‚ˆã†ã³ï¼‰", zh: "æ˜ŸæœŸå¹¾" }, { jp: "ç•ªå·ï¼ˆã°ã‚“ã”ã†ï¼‰", zh: "è™Ÿç¢¼" },
        { jp: "ä½•ç•ªï¼ˆãªã‚“ã°ã‚“ï¼‰", zh: "å¹¾è™Ÿ" }, { jp: "ï½ã‹ã‚‰", zh: "å¾ï½" }, { jp: "ï½ã¾ã§", zh: "åˆ°ï½" },
        { jp: "ï½ã¨ï½", zh: "ï½å’Œï½" }, { jp: "å¤§å¤‰ã§ã™ã­ï¼ˆãŸã„ã¸ã‚“ã§ã™ã­ï¼‰", zh: "ä½ çœŸè¾›è‹¦å•Š" }, { jp: "ãˆãƒ¼ã¨", zh: "é‚£å€‹â€¦" },
        { jp: "ãŠã­ãŒã„ã—ã¾ã™", zh: "éº»ç…©ä½ äº†" }, { jp: "ã‹ã—ã“ã¾ã‚Šã¾ã—ãŸ", zh: "æˆ‘çŸ¥é“äº†" }, { jp: "ãŠã¨ã„ã‚ã‚ã›ã®ã°ã‚“ã”ã†", zh: "æ‚¨æŸ¥è©¢çš„è™Ÿç¢¼æ˜¯â€¦" },
        { jp: "ã©ã†ã‚‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ", zh: "éå¸¸æ„Ÿè¬æ‚¨" }
      ],
      "ç¬¬5èª²": [
        { jp: "è¡Œãã¾ã™", zh: "å»" }, { jp: "æ¥ã¾ã™", zh: "ä¾†" }, { jp: "å¸°ã‚Šã¾ã™", zh: "å›å»" },
        { jp: "å­¦æ ¡ï¼ˆãŒã£ã“ã†ï¼‰", zh: "å­¸æ ¡" }, { jp: "é§…ï¼ˆãˆãï¼‰", zh: "è»Šç«™" }, { jp: "é£›è¡Œæ©Ÿï¼ˆã²ã“ã†ãï¼‰", zh: "é£›æ©Ÿ" },
        { jp: "èˆ¹ï¼ˆãµã­ï¼‰", zh: "èˆ¹" }, { jp: "é›»è»Šï¼ˆã§ã‚“ã—ã‚ƒï¼‰", zh: "é›»è»Š" }, { jp: "åœ°ä¸‹é‰„ï¼ˆã¡ã‹ã¦ã¤ï¼‰", zh: "åœ°ä¸‹éµ" },
        { jp: "æ–°å¹¹ç·šï¼ˆã—ã‚“ã‹ã‚“ã›ã‚“ï¼‰", zh: "æ–°å¹¹ç·š" }, { jp: "ãƒã‚¹", zh: "å·´å£«" }, { jp: "ã‚¿ã‚¯ã‚·ãƒ¼", zh: "è¨ˆç¨‹è»Š" },
        { jp: "è‡ªè»¢è»Šï¼ˆã˜ã¦ã‚“ã—ã‚ƒï¼‰", zh: "è…³è¸è»Š" }, { jp: "æ­©ã„ã¦ï¼ˆã‚ã‚‹ã„ã¦ï¼‰", zh: "èµ°è·¯" }, { jp: "äººï¼ˆã²ã¨ï¼‰", zh: "äºº" },
        { jp: "å‹é”ï¼ˆã¨ã‚‚ã ã¡ï¼‰", zh: "æœ‹å‹" }, { jp: "å½¼ï¼ˆã‹ã‚Œï¼‰", zh: "ä»–ï¼ç”·æœ‹å‹" }, { jp: "å½¼å¥³ï¼ˆã‹ã®ã˜ã‚‡ï¼‰", zh: "å¥¹ï¼å¥³æœ‹å‹" },
        { jp: "å®¶æ—ï¼ˆã‹ããï¼‰", zh: "å®¶äºº" }, { jp: "ä¸€äººã§ï¼ˆã²ã¨ã‚Šã§ï¼‰", zh: "ä¸€å€‹äºº" }, { jp: "å…ˆé€±ï¼ˆã›ã‚“ã—ã‚…ã†ï¼‰", zh: "ä¸Šé€±" },
        { jp: "ä»Šé€±ï¼ˆã“ã‚“ã—ã‚…ã†ï¼‰", zh: "é€™é€±" }, { jp: "æ¥é€±ï¼ˆã‚‰ã„ã—ã‚…ã†ï¼‰", zh: "ä¸‹é€±" }, { jp: "å…ˆæœˆï¼ˆã›ã‚“ã’ã¤ï¼‰", zh: "ä¸Šå€‹æœˆ" },
        { jp: "ä»Šæœˆï¼ˆã“ã‚“ã’ã¤ï¼‰", zh: "é€™å€‹æœˆ" }, { jp: "æ¥æœˆï¼ˆã‚‰ã„ã’ã¤ï¼‰", zh: "ä¸‹å€‹æœˆ" }, { jp: "å»å¹´ï¼ˆãã‚‡ã­ã‚“ï¼‰", zh: "å»å¹´" },
        { jp: "ä»Šå¹´ï¼ˆã“ã¨ã—ï¼‰", zh: "ä»Šå¹´" }, { jp: "æ¥å¹´ï¼ˆã‚‰ã„ã­ã‚“ï¼‰", zh: "æ˜å¹´" }, { jp: "ï½æœˆï¼ˆãŒã¤ï¼‰", zh: "ï½æœˆ" },
        { jp: "ä½•æœˆï¼ˆãªã‚“ãŒã¤ï¼‰", zh: "å¹¾æœˆ" }, { jp: "ï½æ—¥ï¼ˆã«ã¡ï¼‰", zh: "ï½è™Ÿï¼ï½å¤©" }, { jp: "ä½•æ—¥ï¼ˆãªã‚“ã«ã¡ï¼‰", zh: "å¹¾è™Ÿï¼å¹¾å¤©" },
        { jp: "ã„ã¤", zh: "ä»€éº¼æ™‚å€™" }, { jp: "èª•ç”Ÿæ—¥ï¼ˆãŸã‚“ã˜ã‚‡ã†ã³ï¼‰", zh: "ç”Ÿæ—¥" }, { jp: "æ™®é€šï¼ˆãµã¤ã†ï¼‰", zh: "æ™®é€šï¼ˆè»Šï¼‰" },
        { jp: "æ€¥è¡Œï¼ˆãã‚…ã†ã“ã†ï¼‰", zh: "å¿«è»Š" }, { jp: "ç‰¹æ€¥ï¼ˆã¨ã£ãã‚…ã†ï¼‰", zh: "ç‰¹å¿«è»Š" }, { jp: "ã‚ã‚ŠãŒã¨ã† ã”ã–ã„ã¾ã—ãŸ", zh: "è¬è¬ï¼ˆéå»å¼ï¼‰" },
        { jp: "ã©ã†ã„ãŸã—ã¾ã—ã¦", zh: "ä¸å®¢æ°£" }
      ],
     "ç¬¬6èª²": [
{ jp: "é£Ÿã¹ã¾ã™", zh: "åƒ" },
{ jp: "é£²ã¿ã¾ã™", zh: "å–" },
{ jp: "å¸ã„ã¾ã™", zh: "å¸ï¼ˆé¦™è¸ç­‰ï¼‰" },
{ jp: "è¦‹ã¾ã™", zh: "çœ‹" },
{ jp: "èãã¾ã™", zh: "è½" },
{ jp: "èª­ã¿ã¾ã™", zh: "è®€" },
{ jp: "æ›¸ãã¾ã™", zh: "å¯«" },
{ jp: "è²·ã„ã¾ã™", zh: "è²·" },
{ jp: "å–ã‚Šã¾ã™", zh: "æ‹¿" },
{ jp: "å£²ã‚Šã¾ã™", zh: "è³£" },
{ jp: "æ’®ã‚Šã¾ã™", zh: "æ‹ï¼ˆç…§ï¼‰" },
{ jp: "ã—ã¾ã™", zh: "åš" },
{ jp: "ä¼šã„ã¾ã™", zh: "è¦‹é¢" },
{ jp: "é›»è©±ã—ã¾ã™", zh: "æ‰“é›»è©±" },
{ jp: "æ­©ãã¾ã™", zh: "èµ°è·¯" },
{ jp: "éŠã³ã¾ã™", zh: "ç©" },
{ jp: "æ³³ãã¾ã™", zh: "æ¸¸æ³³" },
{ jp: "å¯ã¾ã™", zh: "ç¡è¦º" },
{ jp: "èµ·ãã¾ã™", zh: "èµ·åºŠ" },
{ jp: "ã”é£¯", zh: "é£¯" },
{ jp: "ãƒ‘ãƒ³", zh: "éºµåŒ…" },
{ jp: "åµ", zh: "è›‹" },
{ jp: "è‚‰", zh: "è‚‰" },
{ jp: "é­š", zh: "é­š" },
{ jp: "é‡èœ", zh: "è”¬èœ" },
{ jp: "æœç‰©", zh: "æ°´æœ" },
{ jp: "æ°´", zh: "æ°´" },
{ jp: "ãŠèŒ¶", zh: "èŒ¶" },
{ jp: "ç´…èŒ¶", zh: "ç´…èŒ¶" },
{ jp: "ç‰›ä¹³", zh: "ç‰›å¥¶" },
{ jp: "ã‚¸ãƒ¥ãƒ¼ã‚¹", zh: "æœæ±" },
{ jp: "ãƒ“ãƒ¼ãƒ«", zh: "å•¤é…’" },
{ jp: "ã‚³ãƒ¼ãƒ’ãƒ¼", zh: "å’–å•¡" },
{ jp: "ãŸã°ã“", zh: "é¦™è¸" },
{ jp: "ã¦ãŒã¿", zh: "ä¿¡" },
{ jp: "ãƒ¬ãƒãƒ¼ãƒˆ", zh: "å ±å‘Š" },
{ jp: "ã—ã‚ƒã—ã‚“", zh: "ç…§ç‰‡" },
{ jp: "ãƒ“ãƒ‡ã‚ª", zh: "å½±ç‰‡ã€éŒ„å½±å¸¶" },
{ jp: "æ˜ ç”»", zh: "é›»å½±" },
{ jp: "ã¿ã›", zh: "å•†åº—" },
{ jp: "ã«ã‚", zh: "åº­é™¢ã€é™¢å­" },
{ jp: "ã—ã‚…ãã ã„", zh: "ä½œæ¥­" },
{ jp: "ãƒ†ãƒ‹ã‚¹", zh: "ç¶²çƒ" },
{ jp: "ã‚µãƒƒã‚«ãƒ¼", zh: "è¶³çƒ" },
{ jp: "[ãŠ]ã¯ãªã¿", zh: "è³èŠ±" },
{ jp: "ãªã«", zh: "ä»€éº¼" },
{ jp: "ã„ã£ã—ã‚‡ã«", zh: "ä¸€èµ·" },
{ jp: "ã¡ã‚‡ã£ã¨", zh: "ä¸€æœƒå…’ã€ä¸€é»é»" },
{ jp: "ã„ã¤ã‚‚", zh: "ç¸½æ˜¯" },
{ jp: "ã¨ãã©ã", zh: "æœ‰æ™‚" },
{ jp: "ãã‚Œã‹ã‚‰", zh: "ç„¶å¾Œ" },
{ jp: "ãˆãˆ", zh: "æ˜¯çš„" },
{ jp: "ã„ã„ã§ã™ã­ã€‚", zh: "å¥½å•Š" },
{ jp: "ã‚ã‹ã‚Šã¾ã—ãŸã€‚", zh: "æˆ‘æ˜ç™½äº†" },
{ jp: "ãªã‚“ã§ã™ã‹ã€‚", zh: "ä»€éº¼äº‹ï¼Ÿ" },
{ jp: "ã˜ã‚ƒã€ã¾ãŸ[ã‚ã—ãŸ]ã€‚", zh: "é‚£éº¼ï¼Œæ˜å¤©å†è¦‹ã€‚" }
]
    };
 let lockedWords = [], currentWord = {}, score = 0, correctCount = 0, totalCount = 0;
    let highscore = localStorage.getItem("highscore") || 0;
    let mode = "jpToZh";
    let quizType = "choice";
    let wrongAnswers = [];

    document.getElementById("highscore").textContent = highscore;

    document.getElementById("modeSelect").onchange = () => mode = modeSelect.value;
    document.getElementById("typeSelect").onchange = () => quizType = typeSelect.value;
    document.getElementById("lessonSelect").onchange = updateWordList;

    function updateWordList() {
      const lesson = lessonSelect.value;
      const container = document.getElementById("wordSelection");
      container.innerHTML = "";
      if (!lesson || !allLessons[lesson]) return;
      const list = allLessons[lesson];
      const div = document.createElement("div");
      div.className = "lesson";
      const idPrefix = lesson.replace("ç¬¬", "lesson").replace("èª²", "");
      div.innerHTML = `<h3>${lesson} <button onclick="uncheckAll('${idPrefix}')">å…¨éƒ¨å–æ¶ˆ</button></h3>`;
      list.forEach((word, i) => {
        const id = `${idPrefix}_word${i}`;
        div.innerHTML += `<label><input type="checkbox" id="${id}" value="${word.jp}" checked> ${word.jp}ï¼ˆ${word.zh}ï¼‰</label><br>`;
      });
      container.appendChild(div);
    }

    function uncheckAll(prefix) {
      document.querySelectorAll(`input[id^='${prefix}_']`).forEach(cb => cb.checked = false);
    }

    function getSelectedWords() {
      const lesson = lessonSelect.value;
      const prefix = lesson.replace("ç¬¬", "lesson").replace("èª²", "");
      return allLessons[lesson].filter((_, i) => document.getElementById(`${prefix}_word${i}`).checked);
    }

    function startQuiz() {
      const selected = getSelectedWords();
      if (selected.length === 0) return alert("è«‹è‡³å°‘é¸ä¸€å€‹å–®å­—ï¼");
      lockedWords = [...selected];
      wrongAnswers = [];
      document.getElementById("wordSelection").style.display = "none";
      showNewQuestion();
    }

    function unlockSelection() {
      document.getElementById("wordSelection").style.display = "block";
      lockedWords = [];
      document.getElementById("question").textContent = "â† é»ä¸Šæ–¹æŒ‰éˆ•é–‹å§‹ç·´ç¿’";
      document.getElementById("options").innerHTML = "";
      document.getElementById("result").textContent = "";
    }

    function shuffle(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    function showNewQuestion() {
      currentWord = lockedWords[Math.floor(Math.random() * lockedWords.length)];
      const lesson = lessonSelect.value;
      const fullWords = allLessons[lesson];
      const correct = mode === "jpToZh" ? currentWord.zh : currentWord.jp;
      const qText = mode === "jpToZh" ? `ã€Œ${currentWord.jp}ã€æ˜¯ä»€éº¼æ„æ€ï¼Ÿ` : `ã€Œ${currentWord.zh}ã€çš„æ—¥æ–‡æ˜¯ä»€éº¼ï¼Ÿ`;
      document.getElementById("question").textContent = qText;
      document.getElementById("result").textContent = "";

      const pool = fullWords.map(w => mode === "jpToZh" ? w.zh : w.jp).filter(opt => opt !== correct);
      const options = shuffle([correct, ...shuffle(pool).slice(0, 3)]);
      const optionsDiv = document.getElementById("options");
      optionsDiv.innerHTML = "";

      if (quizType === "choice") {
        options.forEach(opt => {
          const btn = document.createElement("button");
          btn.className = "option-button";
          btn.textContent = opt;
          btn.onclick = () => checkAnswer(opt);
          optionsDiv.appendChild(btn);
        });
      } else {
        const input = document.createElement("input");
        input.type = "text";
        input.id = "inputAnswer";
        input.style.fontSize = "18px";
        input.style.padding = "5px";
        const submitBtn = document.createElement("button");
        submitBtn.textContent = "é€å‡º";
        submitBtn.className = "option-button";
        submitBtn.onclick = () => checkAnswer(input.value.trim());
        optionsDiv.appendChild(input);
        optionsDiv.appendChild(submitBtn);
        input.focus();
      }
    }

    function checkAnswer(answer) {
      const correct = mode === "jpToZh" ? currentWord.zh : currentWord.jp;
      totalCount++;
      const isCorrect = answer.toLowerCase() === correct.toLowerCase();
      if (isCorrect) {
        correctCount++;
        document.getElementById("result").textContent = "âœ… æ­£ç¢ºï¼";
        score += 10;
      } else {
        document.getElementById("result").textContent = `âŒ éŒ¯äº†ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ã€Œ${correct}ã€`;
        wrongAnswers.push(currentWord);
      }
      updateStats();
      lockedWords = lockedWords.filter(w => w !== currentWord);
      if (lockedWords.length === 0) {
        document.getElementById("quizArea").style.display = "none";
        document.getElementById("endScreen").style.display = "block";
        document.getElementById("finalScore").textContent = score;
        saveHistoryRecord();
        if (wrongAnswers.length > 0) {
          const retryBtn = document.createElement("button");
          retryBtn.textContent = "ğŸ” å†ç·´éŒ¯çš„é¡Œç›®";
          retryBtn.onclick = () => {
            lockedWords = [...wrongAnswers];
            wrongAnswers = [];
            document.getElementById("quizArea").style.display = "block";
            document.getElementById("endScreen").style.display = "none";
            showNewQuestion();
          };
          document.getElementById("endScreen").appendChild(retryBtn);
        }
      } else {
        setTimeout(showNewQuestion, 800);
      }
    }

    function updateStats() {
      document.getElementById("score").textContent = score;
      document.getElementById("correct").textContent = correctCount;
      document.getElementById("total").textContent = totalCount;
      document.getElementById("accuracy").textContent = `${Math.round((correctCount / totalCount) * 100)}%`;
      if (score > highscore) {
        highscore = score;
        localStorage.setItem("highscore", highscore);
        document.getElementById("highscore").textContent = highscore;
      }
    }

    function resetScore() {
      score = 0; correctCount = 0; totalCount = 0;
      updateStats();
      document.getElementById("result").textContent = "";
    }

    function speakWord() {
      const speakText = currentWord.jp || "";
      if (!speakText) return;
      speechSynthesis.cancel();
      const utter = new SpeechSynthesisUtterance(speakText);
      utter.lang = 'ja-JP';
      const voices = speechSynthesis.getVoices();
      const jpVoice = voices.find(v => v.lang === 'ja-JP');
      if (jpVoice) utter.voice = jpVoice;
      speechSynthesis.speak(utter);
    }

    function goHome() {
      document.getElementById("endScreen").style.display = "none";
      document.getElementById("quizArea").style.display = "block";
      document.getElementById("wordSelection").style.display = "block";
      document.getElementById("question").textContent = "â† é»ä¸Šæ–¹æŒ‰éˆ•é–‹å§‹ç·´ç¿’";
      document.getElementById("options").innerHTML = "";
      document.getElementById("result").textContent = "";
      score = 0;
      document.getElementById("score").textContent = score;
    }

    function saveHistoryRecord() {
      const now = new Date();
      const record = {
        time: now.toLocaleString(),
        total: totalCount,
        correct: correctCount,
        accuracy: Math.round((correctCount / totalCount) * 100)
      };
      const history = JSON.parse(localStorage.getItem("quizHistory") || "[]");
      history.unshift(record);
      localStorage.setItem("quizHistory", JSON.stringify(history));
    }

    function showHistory() {
      const history = JSON.parse(localStorage.getItem("quizHistory") || "[]");
      const listDiv = document.getElementById("historyList");
      listDiv.innerHTML = history.length === 0 ? "ç›®å‰æ²’æœ‰ç´€éŒ„ã€‚" : "";
      history.forEach((record, i) => {
        const div = document.createElement("div");
        div.innerHTML = `${i + 1}. ğŸ•’ ${record.time}ï½œğŸ“‹ é¡Œæ•¸ï¼š${record.total}ï½œâœ… ç­”å°ï¼š${record.correct}ï½œğŸ¯ æ­£ç¢ºç‡ï¼š${record.accuracy}%`;
        div.style.marginBottom = "8px";
        listDiv.appendChild(div);
      });
      document.getElementById("historyArea").style.display = "block";
    }

    function hideHistory() {
      document.getElementById("historyArea").style.display = "none";
    }

    function clearHistory() {
      if (confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ­·å²ç´€éŒ„å—ï¼Ÿ")) {
        localStorage.removeItem("quizHistory");
        document.getElementById("historyList").innerHTML = "å·²æ¸…é™¤æ‰€æœ‰ç´€éŒ„ã€‚";
      }
    }
  </script>

  <div style="margin-top: 30px;">
    <a href="index.html">
      <button>ğŸ”™ å›é¦–é </button>
    </a>
  </div>
</body>
</html>






