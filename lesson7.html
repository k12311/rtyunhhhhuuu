<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ç¬¬7ï½9èª² è‡ªé¸å–®å­—ç·´ç¿’</title>
  <style>
    body {
      font-family: "Helvetica Neue", sans-serif;
      background-color: #ffe4f0;
      color: #333;
      padding: 20px;
      text-align: center;
    }
    .lesson {
      background: #fff0f5;
      padding: 10px;
      margin: 20px auto;
      width: fit-content;
      border-radius: 12px;
      text-align: left;
    }
    .lesson h3 {
      margin-top: 0;
    }
    .option-button {
      background-color: #fff;
      margin: 5px;
      padding: 10px 20px;
      border: 2px solid #ff99cc;
      border-radius: 12px;
      font-size: 16px;
      cursor: pointer;
    }
    button {
      padding: 10px 16px;
      margin: 10px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      background-color: #ffccdd;
      cursor: pointer;
    }
    #result {
      margin-top: 10px;
      font-size: 18px;
      font-weight: bold;
    }
    #question {
      font-size: 22px;
      margin: 20px 0;
    }
    #quizArea {
      margin-top: 30px;
      padding: 20px;
      background: #fffafc;
      border-radius: 12px;
    }
  </style>
</head>
<body>
  <h1>ç¬¬7ï½9èª² è‡ªé¸å–®å­—ç·´ç¿’</h1>

  <div>
    é¡Œç›®æ–¹å‘ï¼š
    <select id="modeSelect">
      <option value="jpToZh">æ—¥æ–‡ â¡ ä¸­æ–‡ï¼ˆé è¨­ï¼‰</option>
      <option value="zhToJp">ä¸­æ–‡ â¡ æ—¥æ–‡</option>
    </select>
  </div>

  <div>
    é¡Œå‹é¸æ“‡ï¼š
    <select id="typeSelect">
      <option value="choice">é¸æ“‡é¡Œï¼ˆé è¨­ï¼‰</option>
      <option value="input">æ‰“å­—é¡Œ</option>
    </select>
  </div>

  <div>
    é¸æ“‡èª²æ¬¡ï¼š
    <select id="lessonSelect">
      <option value="">-- è«‹é¸æ“‡èª²æ¬¡ --</option>
      <option value="ç¬¬7èª²">ç¬¬7èª²</option>
      <option value="ç¬¬8èª²">ç¬¬8èª²</option>
      <option value="ç¬¬9èª²">ç¬¬9èª²</option>
    </select>
  </div>

  <div id="wordSelection"></div>
  <button onclick="startQuiz()">â–¶ï¸ é–‹å§‹æ¸¬é©—</button>
  <button onclick="unlockSelection()">ğŸ” é‡æ–°é¸å–®å­—</button>

  <div id="quizArea">
    <div id="question">â† é»ä¸Šæ–¹æŒ‰éˆ•é–‹å§‹ç·´ç¿’</div>
    <div id="options"></div>
    <div id="result"></div>
    <div>
      åˆ†æ•¸ï¼š<span id="score">0</span><br>
      æœ€é«˜åˆ†ï¼š<span id="highscore">0</span><br>
      ç­”å°ç‡ï¼š<span id="accuracy">0%</span>ï¼ˆ<span id="correct">0</span> / <span id="total">0</span> é¡Œï¼‰
    </div>
    <button onclick="speakWord()">ğŸ”Š æœ—è®€æ—¥æ–‡</button>
    <button onclick="resetScore()">ğŸ” é‡ç½®åˆ†æ•¸</button>
  </div>

  <div id="endScreen" style="display: none; margin-top: 20px; text-align: center;">
    <h3>ğŸ‰ æ¸¬é©—å®Œæˆï¼</h3>
    <p>ä½ çš„ç¸½å¾—åˆ†æ˜¯ï¼š<span id="finalScore">0</span> åˆ†</p>
    <button onclick="goHome()">ğŸ”™ å›é¦–é </button>
  </div>

  <div style="margin-top: 20px;">
    <button onclick="showHistory()">ğŸ“œ çœ‹æ­·å²ç´€éŒ„</button>
  </div>

  <div id="historyArea" style="display:none; margin-top: 20px; padding: 10px; background: #fff; border: 2px dashed #ff99cc; border-radius: 12px;">
    <h3>ğŸ“š æ­·å²ç´€éŒ„</h3>
    <div id="historyList"></div>
    <button onclick="clearHistory()">ğŸ—‘ æ¸…é™¤ç´€éŒ„</button>
    <button onclick="hideHistory()">âŒ é—œé–‰</button>
  </div>

  <script>
const allLessons = {
     "ç¬¬7èª²": [
  { jp: "åˆ‡ã‚Šã¾ã™", zh: "åˆ‡ã€å‰ª" },
  { jp: "é€ã‚Šã¾ã™", zh: "å¯„ã€é€" },
  { jp: "ã‚ã’ã¾ã™", zh: "çµ¦" },
  { jp: "ã‚‚ã‚‰ã„ã¾ã™", zh: "æ”¶åˆ°ã€å¾—åˆ°" },
  { jp: "è²¸ã—ã¾ã™", zh: "å€Ÿå‡º" },
  { jp: "å€Ÿã‚Šã¾ã™", zh: "å€Ÿå…¥" },
  { jp: "æ•™ãˆã¾ã™", zh: "æ•™" },
  { jp: "ç¿’ã„ã¾ã™", zh: "å­¸ç¿’" },
  { jp: "ã‹ã‘ã¾ã™", zh: "æ‰“ï¼ˆé›»è©±ï¼‰" },
  { jp: "æ‰‹", zh: "æ‰‹" },
  { jp: "ã¯ã—", zh: "ç­·å­" },
  { jp: "ã‚¹ãƒ—ãƒ¼ãƒ³", zh: "æ¹¯åŒ™" },
  { jp: "ãƒŠã‚¤ãƒ•", zh: "åˆ€å­" },
  { jp: "ãƒ•ã‚©ãƒ¼ã‚¯", zh: "å‰å­" },
  { jp: "ã¯ã•ã¿", zh: "å‰ªåˆ€" },
  { jp: "ãƒ•ã‚¡ãƒƒã‚¯ã‚¹", zh: "å‚³çœŸ" },
  { jp: "ãƒ¯ãƒ¼ãƒ—ãƒ­", zh: "æ–‡å­—è™•ç†æ©Ÿ" },
  { jp: "ãƒ‘ã‚½ã‚³ãƒ³", zh: "å€‹äººé›»è…¦" },
  { jp: "ãƒ‘ãƒ³ãƒ", zh: "æ‰“å­”æ©Ÿ" },
  { jp: "ãƒ›ãƒƒãƒã‚­ã‚¹", zh: "é‡˜æ›¸æ©Ÿ" },
  { jp: "ã‚»ãƒ­ãƒ†ãƒ¼ãƒ—", zh: "é€æ˜è† å¸¶" },
  { jp: "æ¶ˆã—ã‚´ãƒ ", zh: "æ©¡çš®æ“¦" },
  { jp: "ç´™", zh: "ç´™" },
  { jp: "èŠ±", zh: "èŠ±" },
  { jp: "ã‚·ãƒ£ãƒ„", zh: "è¥¯è¡«" },
  { jp: "ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ", zh: "ç¦®ç‰©" },
  { jp: "è·ç‰©", zh: "è¡Œæ" },
  { jp: "ãŠé‡‘", zh: "éŒ¢" },
  { jp: "åˆ‡ç¬¦", zh: "ç¥¨ï¼ˆè»Šç¥¨ç­‰ï¼‰" },
  { jp: "ã‚¯ãƒªã‚¹ãƒã‚¹", zh: "è–èª•ç¯€" },
  { jp: "çˆ¶", zh: "çˆ¶è¦ªï¼ˆè‡ªå·±çš„ï¼‰" },
  { jp: "æ¯", zh: "æ¯è¦ªï¼ˆè‡ªå·±çš„ï¼‰" },
  { jp: "ãŠçˆ¶ã•ã‚“", zh: "çˆ¶è¦ªï¼ˆåˆ¥äººçš„ï¼‰" },
  { jp: "ãŠæ¯ã•ã‚“", zh: "æ¯è¦ªï¼ˆåˆ¥äººçš„ï¼‰" },
  { jp: "ã“ã‚Œã‹ã‚‰", zh: "å¾ç¾åœ¨é–‹å§‹ã€æ¥ä¸‹ä¾†" },
  { jp: "ã™ã¦ãã§ã™ã­ã€‚", zh: "å¥½æ£’å–”ã€‚" },
  { jp: "ã„ã‹ãŒã§ã™ã‹ã€‚", zh: "æ‚¨è¦ºå¾—æ€éº¼æ¨£ï¼Ÿ" },
  { jp: "ã„ãŸã ãã¾ã™ã€‚", zh: "æˆ‘é–‹å‹•äº†ï¼ˆåƒé£¯å‰ï¼‰" },
  { jp: "ã”ã¡ãã†ã•ã¾ã§ã—ãŸã€‚", zh: "æˆ‘åƒé£½äº†ï¼ˆåƒé£¯å¾Œï¼‰" },
  { jp: "æ—…è¡Œ", zh: "æ—…è¡Œ" }
     ],
    "ç¬¬8èª²": [
  { jp: "ãƒãƒ³ã‚µãƒ ï¼ˆãªï¼‰", zh: "è‹±ä¿Šçš„" },
  { jp: "ãã‚Œã„ï¼ˆãªï¼‰", zh: "æ¼‚äº®çš„ã€ä¹¾æ·¨çš„" },
  { jp: "ã—ãšã‹ï¼ˆãªï¼‰", zh: "å®‰éœçš„" },
  { jp: "ã«ãã‚„ã‹ï¼ˆãªï¼‰", zh: "ç†±é¬§çš„" },
  { jp: "ã‚†ã†ã‚ã„ï¼ˆãªï¼‰", zh: "æœ‰åçš„" },
  { jp: "ã—ã‚“ã›ã¤ï¼ˆãªï¼‰", zh: "è¦ªåˆ‡çš„" },
  { jp: "ã’ã‚“ãï¼ˆãªï¼‰", zh: "æœ‰ç²¾ç¥çš„ã€å¥åº·çš„" },
  { jp: "ã²ã¾ï¼ˆãªï¼‰", zh: "ç©ºé–’çš„" },
  { jp: "ã¹ã‚“ã‚Šï¼ˆãªï¼‰", zh: "æ–¹ä¾¿çš„" },
  { jp: "ã™ã¦ãï¼ˆãªï¼‰", zh: "å¾ˆæ£’çš„ã€æ¥µå¥½çš„" },
  { jp: "ãŠãŠãã„", zh: "å¤§çš„" },
  { jp: "ã¡ã„ã•ã„", zh: "å°çš„" },
  { jp: "ã‚ãŸã‚‰ã—ã„", zh: "æ–°çš„" },
  { jp: "ãµã‚‹ã„", zh: "èˆŠçš„" },
  { jp: "ã„ã„ï¼ˆã‚ˆã„ï¼‰", zh: "å¥½çš„" },
  { jp: "ã‚ã‚‹ã„", zh: "å£çš„" },
  { jp: "ã‚ã¤ã„", zh: "ç†±çš„ã€ç‡™çš„ï¼å¤©æ°£ç‚ç†±çš„" },
  { jp: "ã•ã‚€ã„", zh: "å¯’å†·çš„ï¼ˆæ°£æº«ï¼‰" },
  { jp: "ã¤ã‚ãŸã„", zh: "å†°å†·çš„ï¼ˆæ¥è§¸ç‰©ï¼‰" },
  { jp: "ã‚€ãšã‹ã—ã„", zh: "é›£çš„" },
  { jp: "ã‚„ã•ã—ã„", zh: "ç°¡å–®çš„ã€æº«æŸ”çš„" },
  { jp: "ãŸã‹ã„", zh: "é«˜çš„ã€è²´çš„" },
  { jp: "ã‚„ã™ã„", zh: "ä¾¿å®œçš„" },
  { jp: "ã²ãã„", zh: "ä½çš„" },
  { jp: "ãŠã‚‚ã—ã‚ã„", zh: "æœ‰è¶£çš„" },
  { jp: "ã¤ã¾ã‚‰ãªã„", zh: "ç„¡èŠçš„" },
  { jp: "ãŠã„ã—ã„", zh: "å¥½åƒçš„" },
  { jp: "ã„ããŒã—ã„", zh: "å¿™çš„" },
  { jp: "ãŸã®ã—ã„", zh: "é–‹å¿ƒçš„ã€å¿«æ¨‚çš„" },
  { jp: "ã—ã‚ã„", zh: "ç™½è‰²çš„" },
  { jp: "ãã‚ã„", zh: "é»‘è‰²çš„" },
  { jp: "ã‚ã‹ã„", zh: "ç´…è‰²çš„" },
  { jp: "ã‚ãŠã„", zh: "è—è‰²çš„" },
  { jp: "ã•ãã‚‰", zh: "æ«»èŠ±" },
  { jp: "ã‚„ã¾", zh: "å±±" },
  { jp: "ã¾ã¡", zh: "åŸå¸‚ã€è¡—é“" },
  { jp: "ãŸã¹ã‚‚ã®", zh: "é£Ÿç‰©" },
  { jp: "ã¨ã“ã‚", zh: "åœ°æ–¹" },
  { jp: "ã‚Šã‚‡ã†", zh: "å®¿èˆ" },
  { jp: "ã¹ã‚“ãã‚‡ã†", zh: "å­¸ç¿’" },
  { jp: "ã›ã„ã‹ã¤", zh: "ç”Ÿæ´»" },
  { jp: "[ãŠ]ã—ã”ã¨", zh: "å·¥ä½œ" },
  { jp: "ã©ã†", zh: "å¦‚ä½•" },
  { jp: "ã©ã‚“ãªï½", zh: "ä»€éº¼æ¨£çš„ï½" },
  { jp: "ã¨ã¦ã‚‚", zh: "éå¸¸" },
  { jp: "ã‚ã¾ã‚Š", zh: "ä¸å¤ªï¼ˆç”¨æ–¼å¦å®šï¼‰" },
  { jp: "ãã—ã¦", zh: "è€Œä¸”" },
  { jp: "ï½ãŒã€ï½", zh: "ï½ä½†æ˜¯ï½" },
  { jp: "ãŠã’ã‚“ãã§ã™ã‹ã€‚", zh: "ä½ å¥½å—ï¼Ÿ" },
  { jp: "ãã†ã§ã™ã­ã€‚", zh: "æ˜¯å•Š..." },
  { jp: "ãã‚ãã‚ ã—ã¤ã‚Œã„ã—ã¾ã™ã€‚", zh: "å·®ä¸å¤šè©²å‘Šè¾­äº†ã€‚" },
  { jp: "ã¾ãŸ ã„ã‚‰ã£ã—ã‚ƒã£ã¦ãã ã•ã„ã€‚", zh: "æ­¡è¿å†ä¾†ã€‚" }
 ],
     "ç¬¬9èª²": [
  { jp: "ã‚ã‹ã‚Šã¾ã™", zh: "æ‡‚ã€æ˜ç™½" },
  { jp: "ã‚ã‚Šã¾ã™", zh: "æœ‰ï¼ˆç„¡ç”Ÿå‘½ï¼‰" },
  { jp: "å¥½ãï¼ˆãªï¼‰", zh: "å–œæ­¡çš„" },
  { jp: "å«Œã„ï¼ˆãªï¼‰", zh: "è¨å­çš„" },
  { jp: "ä¸Šæ‰‹ï¼ˆãªï¼‰", zh: "æ“…é•·çš„" },
  { jp: "ä¸‹æ‰‹ï¼ˆãªï¼‰", zh: "ä¸æ“…é•·çš„" },
  { jp: "æ–™ç†ï¼ˆã‚Šã‚‡ã†ã‚Šï¼‰", zh: "æ–™ç†" },
  { jp: "é£²ã¿ç‰©ï¼ˆã®ã¿ã‚‚ã®ï¼‰", zh: "é£²æ–™" },
  { jp: "ã‚¹ãƒãƒ¼ãƒ„", zh: "é‹å‹•" },
  { jp: "é‡çƒï¼ˆã‚„ãã‚…ã†ï¼‰", zh: "æ£’çƒ" },
  { jp: "ãƒ€ãƒ³ã‚¹", zh: "è·³èˆ" },
  { jp: "éŸ³æ¥½ï¼ˆãŠã‚“ãŒãï¼‰", zh: "éŸ³æ¨‚" },
  { jp: "æ­Œï¼ˆã†ãŸï¼‰", zh: "æ­Œæ›²" },
  { jp: "ã‚¯ãƒ©ã‚·ãƒƒã‚¯", zh: "å¤å…¸éŸ³æ¨‚" },
  { jp: "ã‚¸ãƒ£ã‚º", zh: "çˆµå£«éŸ³æ¨‚" },
  { jp: "ã‚³ãƒ³ã‚µãƒ¼ãƒˆ", zh: "éŸ³æ¨‚æœƒ" },
  { jp: "ã‚«ãƒ©ã‚ªã‚±", zh: "å¡æ‹‰OK" },
  { jp: "æ­Œèˆä¼ï¼ˆã‹ã¶ãï¼‰", zh: "æ­Œèˆä¼ï¼ˆæ—¥æœ¬å‚³çµ±æˆ²åŠ‡ï¼‰" },
  { jp: "çµµï¼ˆãˆï¼‰", zh: "ç•«" },
  { jp: "å­—ï¼ˆã˜ï¼‰", zh: "å­—ã€æ–‡å­—" },
  { jp: "æ¼¢å­—ï¼ˆã‹ã‚“ã˜ï¼‰", zh: "æ¼¢å­—" },
  { jp: "ãƒ­ãƒ¼ãƒå­—ï¼ˆã‚ãƒ¼ã¾ã˜ï¼‰", zh: "ç¾…é¦¬å­—" },
  { jp: "ã²ã‚‰ãŒãª", zh: "å¹³å‡å" },
  { jp: "ã‚«ã‚¿ã‚«ãƒŠ", zh: "ç‰‡å‡å" },
  { jp: "ç”¨äº‹ï¼ˆã‚ˆã†ã˜ï¼‰", zh: "äº‹æƒ…ã€äº‹å‹™" },
  { jp: "ç´„æŸï¼ˆã‚„ãããï¼‰", zh: "ç´„å®š" },
  { jp: "ã”ã—ã‚…ã˜ã‚“", zh: "ï¼ˆåˆ¥äººçš„ï¼‰å…ˆç”Ÿã€ä¸ˆå¤«" },
  { jp: "ãŠã£ã¨ / ã—ã‚…ã˜ã‚“", zh: "ï¼ˆè‡ªå·±çš„ï¼‰å…ˆç”Ÿã€ä¸ˆå¤«" },
  { jp: "ãŠãã•ã‚“", zh: "ï¼ˆåˆ¥äººçš„ï¼‰å¤ªå¤ª" },
  { jp: "ã¤ã¾ / ã‹ãªã„", zh: "ï¼ˆè‡ªå·±çš„ï¼‰å¤ªå¤ª" },
  { jp: "å­ã©ã‚‚", zh: "å°å­©" },
  { jp: "ã‚ˆã", zh: "å¸¸å¸¸" },
  { jp: "ã ã„ãŸã„", zh: "å¤§è‡´ä¸Šã€å¤§æ¦‚" },
  { jp: "ãŸãã•ã‚“", zh: "å¾ˆå¤š" },
  { jp: "å°‘ã—ï¼ˆã™ã“ã—ï¼‰", zh: "ä¸€é»é»" },
  { jp: "ãœã‚“ãœã‚“", zh: "å®Œå…¨ï¼ˆä¸ï¼‰" },
  { jp: "æ—©ãã€é€Ÿãï¼ˆã¯ã‚„ãï¼‰", zh: "æ—©æ—©åœ°ã€å¿«é€Ÿåœ°" },
  { jp: "ï½ã‹ã‚‰", zh: "å› ç‚ºï½" },
  { jp: "ã©ã†ã—ã¦", zh: "ç‚ºä»€éº¼" },
  { jp: "æ®‹å¿µï¼ˆã§ã™ã­ï¼‰ï¼ˆã–ã‚“ã­ã‚“ï¼‰", zh: "çœŸéºæ†¾å•Š" },
  { jp: "ã‚‚ã—ã‚‚ã—", zh: "å–‚ï¼ˆé›»è©±ç”¨èªï¼‰" },
  { jp: "ã‚ã‚", zh: "å•Šï¼ˆè¡¨ç¤ºæ˜ç™½ï¼‰" },
  { jp: "ã„ã£ã—ã‚‡ã« ã„ã‹ãŒã§ã™ã‹ã€‚", zh: "ä¸€èµ·å»å¦‚ä½•ï¼Ÿ" },
  { jp: "ï¼ˆï½ã¯ï¼‰ã¡ã‚‡ã£ã¨â€¦â€¦ã€‚", zh: "ï¼ˆï½ï¼‰æœ‰é»å›°é›£â€¦â€¦" },
  { jp: "ã ã‚ã§ã™ã‹ã€‚", zh: "ä¸è¡Œå—ï¼Ÿ" },
  { jp: "ã¾ãŸ ä»Šåº¦ï¼ˆã“ã‚“ã©ï¼‰ ãŠã­ãŒã„ã—ã¾ã™ã€‚", zh: "ä¸‹æ¬¡è«‹å†ç´„æˆ‘ã€‚" }
]
 };

    let lockedWords = [], currentWord = {}, score = 0, correctCount = 0, totalCount = 0;
    let highscore = localStorage.getItem("highscore") || 0;
    let mode = "jpToZh";
    let quizType = "choice";
    let wrongAnswers = [];

    document.getElementById("highscore").textContent = highscore;

    document.getElementById("modeSelect").onchange = () => mode = modeSelect.value;
    document.getElementById("typeSelect").onchange = () => quizType = typeSelect.value;
    document.getElementById("lessonSelect").onchange = updateWordList;

    function updateWordList() {
      const lesson = lessonSelect.value;
      const container = document.getElementById("wordSelection");
      container.innerHTML = "";
      if (!lesson || !allLessons[lesson]) return;
      const list = allLessons[lesson];
      const div = document.createElement("div");
      div.className = "lesson";
      const idPrefix = lesson.replace("ç¬¬", "lesson").replace("èª²", "");
      div.innerHTML = `<h3>${lesson} <button onclick="uncheckAll('${idPrefix}')">å…¨éƒ¨å–æ¶ˆ</button></h3>`;
      list.forEach((word, i) => {
        const id = `${idPrefix}_word${i}`;
        div.innerHTML += `<label><input type="checkbox" id="${id}" value="${word.jp}" checked> ${word.jp}ï¼ˆ${word.zh}ï¼‰</label><br>`;
      });
      container.appendChild(div);
    }

    function uncheckAll(prefix) {
      document.querySelectorAll(`input[id^='${prefix}_']`).forEach(cb => cb.checked = false);
    }

    function getSelectedWords() {
      const lesson = lessonSelect.value;
      const prefix = lesson.replace("ç¬¬", "lesson").replace("èª²", "");
      return allLessons[lesson].filter((_, i) => document.getElementById(`${prefix}_word${i}`).checked);
    }

    function startQuiz() {
      const selected = getSelectedWords();
      if (selected.length === 0) return alert("è«‹è‡³å°‘é¸ä¸€å€‹å–®å­—ï¼");
      lockedWords = [...selected];
      wrongAnswers = [];
      document.getElementById("wordSelection").style.display = "none";
      showNewQuestion();
    }

    function unlockSelection() {
      document.getElementById("wordSelection").style.display = "block";
      lockedWords = [];
      document.getElementById("question").textContent = "â† é»ä¸Šæ–¹æŒ‰éˆ•é–‹å§‹ç·´ç¿’";
      document.getElementById("options").innerHTML = "";
      document.getElementById("result").textContent = "";
    }

    function shuffle(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    function showNewQuestion() {
      currentWord = lockedWords[Math.floor(Math.random() * lockedWords.length)];
      const lesson = lessonSelect.value;
      const fullWords = allLessons[lesson];
      const correct = mode === "jpToZh" ? currentWord.zh : currentWord.jp;
      const qText = mode === "jpToZh" ? `ã€Œ${currentWord.jp}ã€æ˜¯ä»€éº¼æ„æ€ï¼Ÿ` : `ã€Œ${currentWord.zh}ã€çš„æ—¥æ–‡æ˜¯ä»€éº¼ï¼Ÿ`;
      document.getElementById("question").textContent = qText;
      document.getElementById("result").textContent = "";

      const pool = fullWords.map(w => mode === "jpToZh" ? w.zh : w.jp).filter(opt => opt !== correct);
      const options = shuffle([correct, ...shuffle(pool).slice(0, 3)]);
      const optionsDiv = document.getElementById("options");
      optionsDiv.innerHTML = "";

      if (quizType === "choice") {
        options.forEach(opt => {
          const btn = document.createElement("button");
          btn.className = "option-button";
          btn.textContent = opt;
          btn.onclick = () => checkAnswer(opt);
          optionsDiv.appendChild(btn);
        });
      } else {
        const input = document.createElement("input");
        input.type = "text";
        input.id = "inputAnswer";
        input.style.fontSize = "18px";
        input.style.padding = "5px";
        const submitBtn = document.createElement("button");
        submitBtn.textContent = "é€å‡º";
        submitBtn.className = "option-button";
        submitBtn.onclick = () => checkAnswer(input.value.trim());
        optionsDiv.appendChild(input);
        optionsDiv.appendChild(submitBtn);
        input.focus();
      }
    }

    function checkAnswer(answer) {
      const correct = mode === "jpToZh" ? currentWord.zh : currentWord.jp;
      totalCount++;
      const isCorrect = answer.toLowerCase() === correct.toLowerCase();
      if (isCorrect) {
        correctCount++;
        document.getElementById("result").textContent = "âœ… æ­£ç¢ºï¼";
        score += 10;
      } else {
        document.getElementById("result").textContent = `âŒ éŒ¯äº†ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ã€Œ${correct}ã€`;
        wrongAnswers.push(currentWord);
      }
      updateStats();
      lockedWords = lockedWords.filter(w => w !== currentWord);
      if (lockedWords.length === 0) {
        document.getElementById("quizArea").style.display = "none";
        document.getElementById("endScreen").style.display = "block";
        document.getElementById("finalScore").textContent = score;
        saveHistoryRecord();
        if (wrongAnswers.length > 0) {
          const retryBtn = document.createElement("button");
          retryBtn.textContent = "ğŸ” å†ç·´éŒ¯çš„é¡Œç›®";
          retryBtn.onclick = () => {
            lockedWords = [...wrongAnswers];
            wrongAnswers = [];
            document.getElementById("quizArea").style.display = "block";
            document.getElementById("endScreen").style.display = "none";
            showNewQuestion();
          };
          document.getElementById("endScreen").appendChild(retryBtn);
        }
      } else {
        setTimeout(showNewQuestion, 800);
      }
    }

    function updateStats() {
      document.getElementById("score").textContent = score;
      document.getElementById("correct").textContent = correctCount;
      document.getElementById("total").textContent = totalCount;
      document.getElementById("accuracy").textContent = `${Math.round((correctCount / totalCount) * 100)}%`;
      if (score > highscore) {
        highscore = score;
        localStorage.setItem("highscore", highscore);
        document.getElementById("highscore").textContent = highscore;
      }
    }

    function resetScore() {
      score = 0; correctCount = 0; totalCount = 0;
      updateStats();
      document.getElementById("result").textContent = "";
    }

    function speakWord() {
      const speakText = currentWord.jp || "";
      if (!speakText) return;
      speechSynthesis.cancel();
      const utter = new SpeechSynthesisUtterance(speakText);
      utter.lang = 'ja-JP';
      const voices = speechSynthesis.getVoices();
      const jpVoice = voices.find(v => v.lang === 'ja-JP');
      if (jpVoice) utter.voice = jpVoice;
      speechSynthesis.speak(utter);
    }

    function goHome() {
      document.getElementById("endScreen").style.display = "none";
      document.getElementById("quizArea").style.display = "block";
      document.getElementById("wordSelection").style.display = "block";
      document.getElementById("question").textContent = "â† é»ä¸Šæ–¹æŒ‰éˆ•é–‹å§‹ç·´ç¿’";
      document.getElementById("options").innerHTML = "";
      document.getElementById("result").textContent = "";
      score = 0;
      document.getElementById("score").textContent = score;
    }

    function saveHistoryRecord() {
      const now = new Date();
      const record = {
        time: now.toLocaleString(),
        total: totalCount,
        correct: correctCount,
        accuracy: Math.round((correctCount / totalCount) * 100)
      };
      const history = JSON.parse(localStorage.getItem("quizHistory") || "[]");
      history.unshift(record);
      localStorage.setItem("quizHistory", JSON.stringify(history));
    }

    function showHistory() {
      const history = JSON.parse(localStorage.getItem("quizHistory") || "[]");
      const listDiv = document.getElementById("historyList");
      listDiv.innerHTML = history.length === 0 ? "ç›®å‰æ²’æœ‰ç´€éŒ„ã€‚" : "";
      history.forEach((record, i) => {
        const div = document.createElement("div");
        div.innerHTML = `${i + 1}. ğŸ•’ ${record.time}ï½œğŸ“‹ é¡Œæ•¸ï¼š${record.total}ï½œâœ… ç­”å°ï¼š${record.correct}ï½œğŸ¯ æ­£ç¢ºç‡ï¼š${record.accuracy}%`;
        div.style.marginBottom = "8px";
        listDiv.appendChild(div);
      });
      document.getElementById("historyArea").style.display = "block";
    }

    function hideHistory() {
      document.getElementById("historyArea").style.display = "none";
    }

    function clearHistory() {
      if (confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ­·å²ç´€éŒ„å—ï¼Ÿ")) {
        localStorage.removeItem("quizHistory");
        document.getElementById("historyList").innerHTML = "å·²æ¸…é™¤æ‰€æœ‰ç´€éŒ„ã€‚";
      }
    }
  </script>

  <div style="margin-top: 30px;">
    <a href="index.html">
      <button>ğŸ”™ å›é¦–é </button>
    </a>
  </div>
</body>
</html>








